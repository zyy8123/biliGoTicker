# é›†ç¾¤æ­å»ºæŒ‡å—ï¼šBiliTickerStorm

æœ¬æŒ‡å—ä»¥ **è…¾è®¯äº‘æœåŠ¡å™¨** ä¸ºä¾‹ï¼Œä»‹ç»å¦‚ä½•ä½¿ç”¨ **K3s** å¿«é€Ÿæ­å»ºè½»é‡çº§ Kubernetes é›†ç¾¤ï¼Œä»¥éƒ¨ç½²å’Œè¿è¡Œ BiliTickerStorm é¡¹ç›®ã€‚

---

## ğŸ“Œ è¯´æ˜

* é›†ç¾¤é‡‡ç”¨ [K3s](https://docs.k3s.io/zh/quick-start) æ„å»ºï¼Œå› å…¶èµ„æºå ç”¨å°ã€æ˜“äºéƒ¨ç½²ï¼Œéå¸¸é€‚åˆè½»é‡åœºæ™¯ã€‚
* æœ¬æ–‡é»˜è®¤ä½ å·²ç»å…·å¤‡åŸºæœ¬çš„ Linux æ“ä½œçŸ¥è¯†ã€‚

---

## ğŸš€ é›†ç¾¤æ­å»ºæ­¥éª¤

### 1. è´­ä¹°è…¾è®¯äº‘æœåŠ¡å™¨

1. è®¿é—®å¹¶è´­ä¹°äº‘æœåŠ¡å™¨ï¼š[è…¾è®¯äº‘ CVM](https://buy.cloud.tencent.com/cvm)
2. æ¨èé…ç½®ï¼š**2 æ ¸ CPU + 2GB å†…å­˜æˆ–ä»¥ä¸Š**
3. ç³»ç»Ÿé•œåƒï¼š**Ubuntu 24.04 LTS (64ä½)**
4. éœ€åˆ†é…**ç‹¬ç«‹å…¬ç½‘ IP**
5. å…¶ä»–é…ç½®ä½¿ç”¨é»˜è®¤å³å¯ã€‚

ç¤ºä¾‹é…ç½®å‚è€ƒï¼š

![æœåŠ¡å™¨è´­ä¹°ç¤ºä¾‹](img/img_1.png)

ç­‰å¾…æœåŠ¡å™¨åˆ›å»ºå®Œæˆï¼š

![èµ„æºåˆ›å»ºå®Œæˆ](img/img_2.png)

---

### 2. å®‰è£… K3s é›†ç¾¤

é€‰æ‹©ä¸€å°æœåŠ¡å™¨ä½œä¸º **ä¸»èŠ‚ç‚¹ (master)**ï¼Œå…¶ä½™ä½œä¸º **å·¥ä½œèŠ‚ç‚¹ (worker)**ã€‚

ä¾‹å¦‚ï¼š

* æœªå‘½å1 â†’ ä¸»èŠ‚ç‚¹
* æœªå‘½å2ã€æœªå‘½å3 â†’ å·¥ä½œèŠ‚ç‚¹

---

#### 2.1 ä¸»èŠ‚ç‚¹å®‰è£…

1. åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆå°† `<IP>` æ›¿æ¢ä¸ºä¸»èŠ‚ç‚¹å…¬ç½‘ IPï¼‰ï¼š

```bash
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
INSTALL_K3S_MIRROR=cn sh -s - server --tls-san <IP>
```

2. æŸ¥çœ‹å¹¶è®°å½•é›†ç¾¤ tokenï¼ˆä¾›å·¥ä½œèŠ‚ç‚¹åŠ å…¥ä½¿ç”¨ï¼‰ï¼š

```bash
sudo cat /var/lib/rancher/k3s/server/node-token
```

ç¤ºä¾‹æˆªå›¾ï¼š

![æŸ¥çœ‹ token](img/img_3.png)

---

#### 2.2 å·¥ä½œèŠ‚ç‚¹å®‰è£…

åœ¨æ¯ä¸ªå·¥ä½œèŠ‚ç‚¹ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼ˆæ›¿æ¢ä¸ºå®é™…ä¸»èŠ‚ç‚¹çš„ IP å’Œ tokenï¼‰ï¼š

```bash
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
INSTALL_K3S_MIRROR=cn \
K3S_URL=https://<master-ip>:6443 \
K3S_TOKEN=<node-token> sh -
```

ç¤ºä¾‹ï¼š

```bash
curl -sfL https://rancher-mirror.rancher.cn/k3s/k3s-install.sh | \
INSTALL_K3S_MIRROR=cn \
K3S_URL=https://10.206.0.13:6443 \
K3S_TOKEN=K101266...ffbded sh -
```

æˆåŠŸåï¼š

* æœªå‘½å2 èŠ‚ç‚¹æˆªå›¾
  ![worker1](img/img_5.png)

* æœªå‘½å3 èŠ‚ç‚¹æˆªå›¾
  ![worker2](img/img_4.png)

---

### 3. é•œåƒåŠ é€Ÿé…ç½®ï¼ˆå»ºè®®å›½å†…ç”¨æˆ·é…ç½®ï¼‰

åœ¨æ‰€æœ‰èŠ‚ç‚¹ï¼ˆä¸»èŠ‚ç‚¹ + å·¥ä½œèŠ‚ç‚¹ï¼‰ä¸Šæ‰§è¡Œï¼š

```bash
sudo mkdir -p /etc/rancher/k3s/

sudo tee /etc/rancher/k3s/registries.yaml > /dev/null << 'EOF'
mirrors:
  docker.io:
    endpoint:
      - "https://docker-0.unsee.tech"
  gcr.io:
    endpoint:
      - "https://gcr.m.daocloud.io"
  quay.io:
    endpoint:
      - "https://quay.m.daocloud.io"
  registry.k8s.io:
    endpoint:
      - "https://k8s.m.daocloud.io"
EOF
```

é‡å¯ K3s æœåŠ¡ä»¥åº”ç”¨åŠ é€Ÿé…ç½®ï¼š

```bash
# ä¸»èŠ‚ç‚¹
sudo systemctl restart k3s

# å·¥ä½œèŠ‚ç‚¹
sudo systemctl restart k3s-agent
```

éªŒè¯é…ç½®æ˜¯å¦æˆåŠŸï¼š

```bash
sudo ls /var/lib/rancher/k3s/agent/etc/containerd/certs.d
```

---

### 4. æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ï¼ˆå¯é€‰ï¼šä½¿ç”¨ K8sLensï¼‰

1. åœ¨ä¸»èŠ‚ç‚¹è¿è¡Œï¼š

```bash
sudo kubectl config view --minify --raw
```

2. ä¿®æ”¹å…¶ä¸­å†…å®¹ï¼š

å°†ä»¥ä¸‹å†…å®¹ï¼š

```yaml
server: https://127.0.0.1:6443
```

æ”¹ä¸ºï¼š

```yaml
server: https://<your_public_ip>:6443
```

3. å®‰è£…å¹¶ä½¿ç”¨ [K8sLens](https://k8slens.dev/download) å¯¼å…¥é…ç½®ä»¥å›¾å½¢åŒ–æŸ¥çœ‹é›†ç¾¤çŠ¶æ€ã€‚

---

### 5. å®‰è£… Helmï¼ˆç”¨äºåç»­éƒ¨ç½²ï¼‰

åœ¨ä¸»èŠ‚ç‚¹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š

```bash
curl -fsSL -o get_helm.sh https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3
chmod 700 get_helm.sh
./get_helm.sh
```

---

## âœ… ä¸‹ä¸€æ­¥

é›†ç¾¤æ­å»ºå®Œæˆåï¼Œè¯·å‚è€ƒé¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ [`README.md`](../README.md) è¿›è¡Œåç»­éƒ¨ç½²ï¼ˆéƒ¨ç½² BiliTickerStorm æœåŠ¡ç­‰ï¼‰ã€‚

---

## ğŸ”— å‚è€ƒæ–‡æ¡£

* [K3s å®˜æ–¹æ–‡æ¡£ï¼ˆä¸­æ–‡ï¼‰](https://docs.k3s.io/zh/)
* [K8sLens æ–‡æ¡£](https://docs.k8slens.dev/getting-started/add-cluster/)
* [Helm å®˜æ–¹å®‰è£…è„šæœ¬](https://helm.sh/docs/intro/install/)

